---
title: Baslyft, b칛rs och burgare - min f칬rsta PWA
date: 2019-11-24
layout: single.hbs
collection: articles
---

Jag har byggt min f칬rsta [Progressiva Web app][12]: en webbplats som erbjuder
okompromissad offline-funktionalitet och som kan installeras till hemsk칛rmar p친
telefoner och andra enheter som st칬djer det.

Det 칛r en tr칛ningsapp, med dagboksfunktion och n친gra hj칛lpmedel f칬r att lyckas
med styrketr칛ning i gymet. Den ligger hostad p친 Github pages:
[B3: Baslyft, b칛rs och burgare](https://madr.github.io/urban-enigma/).

Detta blogginl칛gg 칛r en utv칛rdering av hur jag planerade projektet, vad jag
ville uppn친 med det och resultatet.

**Disclaimer!** Namnet p친 appen, och 칛ven n친gra av dess funktioner, 칛r
inspirerade fr친n min favorit bland alla poddar och sajter f칬r styrketr칛ning -
[Styrkelabbet](https://styrkelabbet.se). Deras textinneh친ll 칛r sakliga, mycket
k칛llkritiska och motiverande. Deras tr칛ningsprogram fick mig att, efter flera
친rs f칬rs칬k, slutligen f친 in rutiner f칬r att tr칛na f칬r en starkare kropp och ett friskare liv. Att tr칛na 칛r 칛ntligen _kul_.

D칛rmed, kudos till Styrkelabbet! [Deras app](https://www.styrkelabbet.se/app/)
kan jag rekommendera varmt, d친 den vida 칬verstiger denna app i funktionalitet
och smarta funktioner. 游뱅

## 칐nskv칛rda funktioner

Bara f칬r att ha n친got att str칛va mot tog jag fram en lista som definierar 
en acceptabel app f칬r syftet.

- Rent, enkelt gr칛nssnitt med kloka standardbeteenden snarare 칛n
  konfigurationsm칬jligheter.
- En lista 칬ver utf칬rda pass, i omv칛nd kronologisk ordning.
- En [1RM](https://sv.wikipedia.org/wiki/1RM)-ber칛knare.
- M칬jlighet att d칬pa pass.
- L칛gg till set (_칬vningsnamn_, _vikt_ och _repetitioner_) med sm친, smarta
  funktioner f칬r 칬kad produktivitet.
- M칬jlighet att definiera ett set som _uppv칛rmningsset_.
- Braiga nyckeltal: antalet lyfta ton per pass, totala antalet set och totala
  antalet repetitioner.
- F친r g칛rna fungera i splitscreen-l칛ge (s친 att tidtagarurets app kan ligga
  bredvid).

## Tekniska m친l

N칛r jag s친g [Jake Archibalds Google I/O-presentation av offline-first Web
Apps][2] 2016 blev jag riktigt nyfiken p친 _Service Workers_, som p친 den tiden
var hipster-prylar. 츿nda sedan jag l칛ste [Going offline av Jeremy Keith][1]
2018 visste jag att detta 칛r n친got som kommer att bli en grej.

I och med [mitt avancemang mot React i 친r][3] var jag inte sv친r칬vertalad att
hitta p친 n친got kul. Jag besl칬t mig f칬r att s칛tta upp litet tekniska projektm친l.

- S친 snart jag laddat sidan och lagt till den p친 hemsk칛rmen, s친 ska den fungera
  i Flight mode. Detta kallas [Offline-first][5].
- Bekantskap med [Parcel bundler][4], f칬r att se hur ett alternativ till
  Webpack st친r sig.
- V칛nja mig vid [Prettier][6] f칬r automatisk formatering.
- Skriva ett projekt fr친n b칬rjan med [7-1 Sass guidelines][7].
- Forts칛tta kika p친 React med Redux.
- Lagra all data lokalt med [LocalStorage][11] och Redux middleware, [som en
  app snarare 칛n en hemsida][8].
- Komplett testning med [Jest][9] och eventuellt [Enzyme][10].

## Metod och arbetsprocess

Jag 칛gnade f칬rst en stund 친t att s칛tta upp ett app-skal med _React_, _Redux_,
_Redux-Sagas_ (bara f칬r att ha det p친 plats) och f친 allt detta att bundlas med
_Parcel_.

D칛refter skrev jag ett _Redux-middleware_ f칬r att automatiskt synka state med
_localStorage_ vid uppdatering (via _reducers_) och initiering (sidladdning).

En sak jag d칛refter donade en stund med var att f친 r칛tt tangentbord att visas
vid inmatning i formul칛r f칬r nya set och nya pass, samt att navigering mellan
formul칛r skulle fungera p친 ett bra s칛tt.

N친gonstans h칛r b칬rjade jag inse att jag beh칬vde konfigurera min kodeditor till
att b칬rja _linta_ och _automatiskt formatera_ min kod 친t mig, snarare 칛n att jag
manuellt skulle g칬ra det. [^2]

Som ett f칬rsta steg mot att bli PWA skrev jag h칛r ett [Web App Manifest][13],
den f칬rsta halvan av att bli _Offline first_.

Den andra halvan 칛r att skriva en _Service Worker_. F칬r detta projekt k칛nde jag
att det inte var v칛rt att investera tid i att skriva en Service Worker fr친n
skratch, s친 jag valde ist칛llet att l친ta en Parcel-plugin generera en Service
Worker 친t mig.

N친gra _reducers_, _actions_, _komponenter_, hj칛lpfunktioner och _containers_[^1] b칬rjade
falla p친 plats, s친 nu var det h칬g tid att skriva tester. Jag lade d칛rf칬r en
stund p친 att f친 ig친ng *Jest*, automatisera testf칬rfarandet och att d칛refter
skriva tester f칬r den funktionalitet jag f친tt p친 plats.

D칛rifr친n var all grund p친 plats, s친 h칛rifr친n fortsatte jag koda p친 funktioner i
appen. Jag skrev fler tester, jag testade av och f칬rb칛ttrade design, jag
ut칬kade och snyggade till kodens struktur.

## Resultatet

Vid [version 1.4](https://github.com/madr/urban-enigma/releases/tag/v1.4) hade jag st칛ngt alla tekniska m친l jag ville uppn친 f칬r projektet. 游볙 I detta l칛ge konfigurerade jag [Travis CI](https://travis-ci.org/madr/urban-enigma) f칬r att p친bjuda fortsatt bra rutiner.

Jag har personligen anv칛nt appen p친 gymet i ett par m친nader, och har hunnit
g칬ra ett par releaser med f칬rb칛ttringar och nya funktioner ut칬ver den initiella
kravlistan.

## 4 saker v칛rda att uppm칛rksamma i koden

F칬r det f칬rsta, hur man visar r칛tt tangentbord f칬r nummerf칛lt, samt hur man ger st칬d f칬r _b친de_ kommatecken och punkt som skiljetecken:

```jsx
<React.Fragment>
  <label htmlFor="weight">Vikt</label>
  <input
    id="weight"
    type="number"
    min="2.5"
    step="0.5"
    lang="en-150"
    pattern="[0-9]*"
    inputMode="decimal"
    value={value}
    onChange={handleOnChange}
  />
</React.Fragment>
```

- `inputMode` 칛r det som visar ett numeriskt tangentbord, ist칛llet f칬r ett alfabetiskt tangentbord. Detta 칛r n친got som 90% av v칛rldens alla webbshopar skulle kunna fundera p친 att l칛gga till i sina checkout-formul칛r.
- `lang="en-150"` ser till att b친de kommatecken och punkt fungerar, d친 [vi alla inte lever i Amerika][14]. Det h칛r skulle g칛rna fler st칬rre akt칬rer f친 st칬dja ocks친 (jag tittar p친 dig, Google docs!).

Det 칛r ocks친 v칛rt att visa att [f칛ltet 칛r kontrollerat av React][15].

Bonus: jag tar med `htmlFor` ocks친, f칬r att JSX sannerligen inte 칛r vackert
ibland i de fall man valt att 칛rva fr친n ur친ldriga DOM API-best칛mmelser, vilket bara blir f칬rvirrande n칛r JSX kan antas vara 칛mnat att likna HTML. `className` 칛r en annan favorit i samma kategori.

F칬r det andra: hur f친nigt enkelt det var att skapa persistent state med localStorage och redux middleware!

```javascript
const ITEM_NAME = "BBB";

// synka 칛ndrat state till localStorage
const localStorageMiddleware = ({ getState }) => {
  return next => action => {
    const result = next(action);
    localStorage.setItem(ITEM_NAME, JSON.stringify(getState()));
    return result;
  };
};

// ladda initiellt state i createStore() fr친n localStorage
export const reHydrateStore = () => {
  if (localStorage.getItem(ITEM_NAME) !== null) {
    return JSON.parse(localStorage.getItem(ITEM_NAME));
  }
};

export default localStorageMiddleware;
```

Visst, jag hade ett tag en tanke p친 att l친ta Service Workern skriva till localStorage ist칛llet, och l친ta appen skicka 칛ndringarna som `fetch()` med _Redux-Sagas_. Jag 칬vergav dock denna id칠 d친 ovanst친ende l칬sning visade sig vara god nog f칬r denna app.

F칬r det tredje: HTML5-elementet `<details>`, samt HTML5-attributet `form` p친 buttons.

```jsx
{ /* Details-elementet: accordion utan JavaScript! */ }
<details>
  <summary>Press Pasodoble 2.1 (2019-11-01)</summary>
  <table>
    { /* ... */ }
  </table>
</details>

{ /* form-attributet: knappen ligger utanf칬r formul칛ret! */ }
<header>
  <h1>L칛gg till nytt pass</h1>
  <button type="submit" form="new-workout">Starta</button>
</header>
<form id="new-workout">
  { /* ... */ }
</form>
```

`<details>` ger utvecklare en chans att toggla saker p친 ett trevligt s칛tt utan
att blanda in JavaScript. Github anv칛nder det f칬r alla kontextberoende menyer
som kan klickas fram via en handle, exempelvis en knapp med ett kugghjul p친.
Det finns goda m칬jligheter att [칛ndra utseende med CSS](http://html5doctor.com/the-details-and-summary-elements/), men tillg칛nglighetsst칬det 칛r dessv칛rre inte
helt optimal i dagsl칛get.

Attributet `form` p친 knappar 칛r otroligt smidigt! Det till친ter knappar som g칬r
saker med formul칛ret ligga utanf칬r `<form>`, exempelvis i en fixerad toolbar
som jag till칛mpar i det h칛r projektet.

Slutligen: att det med `<datalist>` g친r alldeles utm칛rkt att f친 autofill och 
f칬rslag helt utan JavaScript.

```jsx
<datalist id="exercises">
  <option>Bicepscurls</option>
  <option>B칛nkpress</option>
  <option>Chins</option>
  <option>Kn칛b칬j</option>
  <option>Marklyft</option>
</datalist>
{ /* ... */ }
<input type="text" autocomplete="off" list="exercises" />
```

I webbl칛sare s친 f칬resl친s h칛r saker ur listan, snyggt integrerat native 
i telefonens tangentbord och i en lista med matchande val, i ett 
`<select>`-liknande beteende.

## Avslutande ord

Appen utvecklas hela tiden, och jag klurar hela tiden p친 hur den ska vara
mindre i v칛gen fr친n det jag g칬r p친 gymet. Mest roligt 칛r det att skruva p친
designen, d친 jag aldrig slutas att f칬rundras 칬ver hur sm친 nyanser kan skapa
stor skillnad.

N칛r en design har satt sig, och jag l칬st n친gra tr친kiga buggar, kanske n친gra
sk칛rmdumpar eller videoklipp kommer upp. Kanske!

[1]: https://abookapart.com/products/going-offline
[2]: https://www.youtube.com/watch?v=cmGr0RszHc8&t=5s
[3]: ../react-redux/
[4]: https://parceljs.org/
[5]: http://offlinefirst.org/
[6]: https://prettier.io/
[7]: https://sass-guidelin.es/
[8]: https://remysharp.com/2014/10/06/what-is-a-web-app
[9]: https://jestjs.io/
[10]: https://airbnb.io/enzyme/
[11]: https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Local_storage
[12]: https://en.wikipedia.org/wiki/Progressive_web_applications
[13]: https://developer.mozilla.org/en-US/docs/Web/Manifest
[14]: https://friendlybit.com/other/im-not-from-america/
[15]: https://goshakkk.name/controlled-vs-uncontrolled-inputs-react/

[^1]: Detta 칛r React- och Redux-saker. Om detta 칛r obekant, kika p친 [Redux in 5 minutes](https://www.codementor.io/johnanisere/learn-redux-in-5-mins-j12ibbr33) f칬r att f친 litet koll.

[^2]: I VS Code, som jag anv칛nde prim칛rt f칬r detta projekt, 칛r detta supersmidigt med befintliga extensions. Jag installerade Prettier-till칛gget, och aktiverade "format on save" f칬r alla filer.